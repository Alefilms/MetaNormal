// main global script file
DynamicSprite *buttonSprite; 
// called when the game starts, before the first room is loaded
function game_start() 
{
  BCerrarInventario.Visible = false;
}
//CODIGO PARA COMPROBRAR PARTIDAS PARA GUARDAR
//---------------------------------------------------------------------//
// Busca las partidas existentes
int BuscaPartidas(String nombre)
{
  bool partidas[] = new bool[999];
  int i = 0;
  while (i < ListaDeGuardado.ItemCount)
  {
    if (ListaDeGuardado.Items[i] == nombre)
    {
      //  Busca una partida existente con que coicida con el nombre
      return ListaDeGuardado.SaveGameSlots[i];
    }
    // Recuerda las partidas que ya estan tomas
    partidas[ListaDeGuardado.SaveGameSlots[i]] = true;
    i++;
  }
 
  // Busca el primer casillero libre, empezando con el casillero  1
  i = 1;
  while (i < 999)
  {
    if (!partidas[i])
      return i;
    i++;
  }
  // Si no hay casilleros libres
  return -1;
}

// Muestra las partidas existentes
function MuestraDialogoDeGuardado()
{
  gGuardar.Visible = true;
  // Muestra la lista de guardados
  ListaDeGuardado.FillSaveGameList();
  // Si hay al menos una partida
  if (ListaDeGuardado.ItemCount > 0)
  {
     // Muestra la imagen de la partida  
 
       int PartidaGuardada = ListaDeGuardado.SaveGameSlots[ListaDeGuardado.SelectedIndex];

      buttonSprite = DynamicSprite.CreateFromSaveGame(PartidaGuardada, 500, 281);

        if (buttonSprite != null) 
          {
            BScreenShot.NormalGraphic = buttonSprite.Graphic;
          }
       
    TxtNuevoGuardado.Text = ListaDeGuardado.Items[0];
  }
  else
  {
    buttonSprite = null;
    // Si no hay partidas que muestre el texto vacio
    TxtNuevoGuardado.Text = "";
  }
  mouse.UseModeGraphic(eModePointer);

}
//CODIGO PARA COMPROBRAR PARTIDAS PARA CARGAR
//---------------------------------------------------------------------//
function MuestraDialogoDeCargado()
{
  gCargar.Visible = true;
  ListaDeCargado.FillSaveGameList();
  mouse.UseModeGraphic(eModePointer);
  
  if (ListaDeCargado.ItemCount > 0)
  {
     // Muestra la imagen de la partida  
 
     int PartidaGuardada = ListaDeCargado.SaveGameSlots[ListaDeCargado.SelectedIndex];

      buttonSprite = DynamicSprite.CreateFromSaveGame(PartidaGuardada, 500, 281);

if (buttonSprite != null) 
    {
      BScreenShotCargado.NormalGraphic = buttonSprite.Graphic;
    }
  }

}
// put anything you want to happen every game cycle in here
function repeatedly_execute() 
{
}

// put here anything you want to happen every game cycle, even when the game is blocked
function repeatedly_execute_always() 
{
 
}

// called when a key is pressed. keycode holds the key's ASCII code
function on_key_press(eKeyCode keycode) 
{
  if (IsGamePaused()) keycode = 0; // game paused, so don't react to keypresses
  
  if (keycode == eKeyCtrlQ) QuitGame(1); // Ctrl-Q
  if (keycode == eKeyF9) RestartGame(); // F9
  if (keycode == eKeyF12) SaveScreenShot("scrnshot.pcx");  // F12
  if (keycode == eKeyCtrlS) Debug(0,0); // Ctrl-S, give all inventory
  if (keycode == eKeyCtrlV) Debug(1,0); // Ctrl-V, version
  if (keycode == eKeyCtrlA) Debug(2,0); // Ctrl-A, show walkable areas
  if (keycode == eKeyCtrlX) Debug(3,0); // Ctrl-X, teleport to room
  
  
  // Guarda rapido la partida con F5
  if (keycode == eKeyF5)
   
   if (player.Room == 4)
      {
        
      }
   else 
   {
    SaveGameSlot(99,"Guardado Rapido");
    gGuardadoRapido.Visible = true;
     int transGuardado = gGuardadoRapido.Transparency;
     while (transGuardado > 20 ) 
     {
       transGuardado -= 2;
       gGuardadoRapido.Transparency = transGuardado;
       Wait(1);
     }
       while (transGuardado < 70 ) 
     {
       transGuardado += 2;
       gGuardadoRapido.Transparency = transGuardado;
       Wait(1);
       
        if ( transGuardado == 70)
        {
          gGuardadoRapido.Visible = false;
        }
     }
  }
  
   // Carga rapido la partida con F5
  if (keycode == eKeySpace)
  {
    RestoreGameSlot(99);
  }
  // Cerrar el gui de guardar
  if ((keycode == eKeyEscape) && (gGuardar.Visible == true))
  {
    gGuardar.Visible = false;
  }
  // Cerrar el gui de Cargar
   if ((keycode == eKeyEscape) && (gCargar.Visible == true))
  {
    gCargar.Visible = false;
  }
  // Abrir el menu aprentando Escape----------------------
  if (keycode == eKeyEscape)
  {
  
    int transMenu = gMenu.Transparency;
    int transFade =gFade.Transparency;
     if (gConfirmacionDeSalir.Visible == true)
       {
         gConfirmacionDeSalir.Visible = false;
       }
      
      if (player.Room == 4)
      {
        
      }
         // Hacer visible el menu----------------------
    else if ( gMenu.Visible == false)
    {
         mouse.Mode = eModePointer;
      gMenu.Visible = true;
      gFade.Visible = true;
        while (transMenu > 20 ) 
        {
            
          transMenu-= 2;
          transFade-= 2;
          gMenu.Transparency = transMenu;
          gFade.Transparency = transFade;
          Wait(1);
        }
    }
         // Hacer invisible el menu------------------------
      else if ( gMenu.Visible == true)
       {
          
     
        while (transMenu < 70 ) 
        {
          transMenu+= 2;
          transFade+= 2;
          gMenu.Transparency = transMenu;
          gFade.Transparency = transFade;
          Wait(1);
            if (transMenu == 70)
            {
              gMenu.Visible = false;
              gFade.Visible = false;
           mouse.Mode = eModeWalkto;
            }
        }
       }

   
  }

}

function on_mouse_click(MouseButton button) // called when a mouse button is clicked. button is either LEFT or RIGHT
{
  if (IsGamePaused() == 1) // Game is paused, so do nothing (ie. don't allow mouse click)
  {
  }
  else if (button == eMouseLeft) 
  {
    Room.ProcessClick(mouse.x,mouse.y, mouse.Mode);
  }
  else // right-click, so cycle cursor
  {   
    mouse.SelectNextMode();
  }
}


function dialog_request(int param) {
}

function Hablar (String Loquedice)
{
}
function HablarSantiago (String Loquedice)
{
}

function TalkDefault ()
{
}

function HablarCosa (String Loquedice)
{
  }
// Boton para subirr en el inventario
function BFlechaArriba_OnClick(GUIControl *control, MouseButton button)
{
InventoryWindow1.ScrollUp();
}
// Boton para bajar en el inventario
function BFlechaAbajo_OnClick(GUIControl *control, MouseButton button)
{
InventoryWindow1.ScrollDown();
}
// Boton para abrir el inventario
function BAbrirInventario_OnClick(GUIControl *control, MouseButton button)
{
 if (gInventario.Visible == false)
 {
  gInventario.Visible = true;
  BAbrirInventario.Visible = false;
  BCerrarInventario.Visible = true;
 }
}
// Boton para cerrar el inventario
function BCerrarInventario_OnClick(GUIControl *control, MouseButton button)
{
if (gInventario.Visible == true)
 {
  gInventario.Visible = false;
  BCerrarInventario.Visible = false;
  BAbrirInventario.Visible = true;
 }

}
// Boton del menu para resumir la partida
function BResumir_OnClick(GUIControl *control, MouseButton button)
{
  int transMenu = gMenu.Transparency;
  int transFade = gFade.Transparency; 
if ( gMenu.Visible == true)
       {
        while (transMenu < 70 ) 
        {
          transMenu++;
          transFade++;
          gMenu.Transparency = transMenu;
          gFade.Transparency = transFade;
          Wait(1);
            if (transMenu == 70)
            {
              gMenu.Visible = false;
              gFade.Visible = false;
            }
        }
       }
}

// Boton para si salir del juego
function BSi_OnClick(GUIControl *control, MouseButton button)
{
QuitGame(0);
}
// Boton para no salir del juego
function BNo_OnClick(GUIControl *control, MouseButton button)
{
gConfirmacionDeSalir.Visible = false;
}
// Boton del menu que muestra el gui para confirmar salir del juego
function BSalir_OnClick(GUIControl *control, MouseButton button)
{
gConfirmacionDeSalir.Visible = true;
}
// Boton del menu de Inicio que muestra el gui para confirmar salir del juego
function BSalirInicio_OnClick(GUIControl *control, MouseButton button)
{
gConfirmacionDeSalir.Visible = true;
}
// Boton del menu de Inicio para comenzar una nueva partida
function BNuevaPartida_OnClick(GUIControl *control, MouseButton button)
{
gMenuInicio.Visible = false;
player.ChangeRoom(1);
}
//---------BOTONES PARA GUARDAR PARTIDA--------//
// Muestra el gui de guardar partida desde el menu de inicio
function BGuardarMenu_OnClick(GUIControl *control, MouseButton button)
{
MuestraDialogoDeGuardado();
}
// Guarda la partida
function BGuardar_OnClick(GUIControl *control, MouseButton button)
{
   int LugarAGuardarPartida = BuscaPartidas(TxtNuevoGuardado.Text);
  if (LugarAGuardarPartida < 0)
  {
    return;
  }
gGuardar.Visible = false;
gMenu.Transparency = 70;
gFade.Transparency = 100;
gFade.Visible = false;
gMenu.Visible = false;
Wait(1);
SaveGameSlot(LugarAGuardarPartida, TxtNuevoGuardado.Text);
} 
// Cancela el guardado
function BCancelarGuardado_OnClick(GUIControl *control, MouseButton button)
{
gGuardar.Visible = false;
}
// Borra la partida
function BBorrar_OnClick(GUIControl *control, MouseButton button)
{
  if (ListaDeGuardado.SelectedIndex >= 0)
  {
    DeleteSaveSlot(ListaDeGuardado.SaveGameSlots[ListaDeGuardado.SelectedIndex]);
    ListaDeGuardado.FillSaveGameList();
  }
}
// Guarda la partida si aprentamos enter una vez despues de escribir
function TxtNuevoGuardado_OnActivate(GUIControl *control)
{
BGuardar_OnClick(control, eMouseLeft);
}
// Muestra en el TXT y la imagen la partida seleccionada 
function ListaDeGuardado_OnSelectionChanged(GUIControl *control)
{
TxtNuevoGuardado.Text = ListaDeGuardado.Items[ListaDeGuardado.SelectedIndex];
   
   int PartidaGuardada = ListaDeGuardado.SaveGameSlots[ListaDeGuardado.SelectedIndex];

      buttonSprite = DynamicSprite.CreateFromSaveGame(PartidaGuardada, 500, 281);

if (buttonSprite != null) 
    {
      BScreenShot.NormalGraphic = buttonSprite.Graphic;
    }


//---------BOTONES PARA CARGAR PARTIDA--------//

}
// Muestra el gui para cargar desde el Menu 
function BCargarMenu_OnClick(GUIControl *control, MouseButton button)
{
MuestraDialogoDeCargado();
}
// Muestra el gui para cargar desde el Menu de Inicio
function BCargarPartidaInicio_OnClick(GUIControl *control, MouseButton button)
{
MuestraDialogoDeCargado();
}
// Carga la partida
function BCargar_OnClick(GUIControl *control, MouseButton button)
{

  if (ListaDeCargado.SelectedIndex >= 0)
  {
    RestoreGameSlot(ListaDeCargado.SaveGameSlots[ListaDeCargado.SelectedIndex]);
  }
}
// Cancela el cargado 
function BCancelarCargado_OnClick(GUIControl *control, MouseButton button)
{
gCargar.Visible = false;
}
// Muestra en el TXT y la imagen la partida seleccionada para cargar
function ListaDeCargado_OnSelectionChanged(GUIControl *control)
{
   int PartidaGuardada = ListaDeCargado.SaveGameSlots[ListaDeCargado.SelectedIndex];

      buttonSprite = DynamicSprite.CreateFromSaveGame(PartidaGuardada, 500, 281);

if (buttonSprite != null) 
    {
      BScreenShotCargado.NormalGraphic = buttonSprite.Graphic;
    }
}
